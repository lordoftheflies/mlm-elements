<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-dropdown/iron-dropdown.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-input/paper-input-container.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-checkbox/paper-checkbox.html">
<link rel="import" href="../file-upload/file-upload.html">

<link rel="import" href="../paper-chip/paper-chip.html">
<link rel="import" href="mlm-shared-styles.html">
<link rel="import" href="../plutonium-elements/plutonium-elements.html">
<link rel="import" href="../plutonium-manageable-content/plutonium-manageable-content.html">

<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-menu-button/paper-menu-button.html">


</head><body><dom-module id="mlm-share-view">

    <template>

        <style include="mlm-shared-styles">

            :host {
                --paper-menu-background-color: none;
            }

            plutonium-article-form {
                margin: 24px;
            }
            /*            .main-action-fab-container {
                            position: relative;
                        }
                        paper-fab.main-action-fab {
                            position: absolute;
                            bottom: -45px;
                            right: 0px;
                        }
                        paper-fab.minor-action-fab {
                            position: absolute;
                            top: -65px;
                            right: 0px;
                        }*/
        </style>

        <iron-ajax id="parentCandidatesAjax" url="{{apiUrl}}/content-management/candidates/parent" last-response="{{parentCandidates}}" auto="">
        </iron-ajax>

        <iron-ajax id="shareAjax" handle-as="json" content-type="application/json" method="POST" url="[[apiUrl]]/content-management/[[accountId]]/save" body="{{contentModel}}"></iron-ajax>
        <iron-ajax id="messageSendAjax" handle-as="json" content-type="application/json" method="POST" on-response="onMessageSendResponse" on-error="onMessageSendError" url="[[apiUrl]]/mailbox/[[accountId]]/send" body="{{shareModel}}"></iron-ajax>
        
        

        <div name="content">
            <paper-card id="propertiesCardTitle" elevation="1" heading="Properties" name="props" class="layout vertical main-action-fab-container">


                <div class="card-content layout horizontal">
                    <div class="layout vertical flex">
                        <paper-dropdown-menu id="parentDdLabel" label="Parent">
                            <paper-listbox id="parentCandidatesList" class="dropdown-content" attr-for-selected="{{attrForSelected}}" items="[[parentCandidates]]" as="parent" selected="{{selectedParent}}">
                                <template is="dom-repeat" items="[[parentCandidates]]">

                                    <paper-item id="[[item.id]]" class="item pad">
                                        <label>[[item.title]]</label> 
                                    </paper-item>
                                </template>
                            </paper-listbox>
                        </paper-dropdown-menu>
                        <paper-input id="contentTitleInput" class="bottom title" label="Title" value="{{contentModel.title}}"></paper-input>
                        <paper-checkbox id="draftIndicator" checked="{{contentModel.draft}}">Draft</paper-checkbox>
                    </div>
                </div>
                <paper-toolbar>

                    <paper-tabs attr-for-selected="name" selected="{{articleContentType}}" style="width: 100%" autoselect="">
                        <paper-tab text-id="embbeddedContentTabLabel" name="embedded">Embed content</paper-tab>
                        <paper-tab text-id="assembledContentTabLabel" name="assembled">Assembled content</paper-tab>
                    </paper-tabs>
                </paper-toolbar>
            </paper-card>

            
            <div id="articleContentCard" heading="{{articleContentHeading}}" elevation="1" class="layout vertical">




                



                <iron-pages selected="{{articleContentType}}" attr-for-selected="name">

                    <div name="assembled" class="card-content layout horizontal" style="padding-top: 10px">
                        <plutonium-article-form class="flex" api-url="{{apiUrl}}" id="pcf" editable="" contacts="{{contacts}}" content-model="{{contentModel}}" parent-candidates="{{parentCandidates}}" editors="[[editorMap]]">
                        </plutonium-article-form>
                    </div>

                        <paper-card id="propertiesCardTitle" name="embedded" class="card-content layout horizontal" elevation="1" heading="Upload article">
                            <file-upload id="uploadFileText" drop-text="Drop any PDF file here." error-text="File upload failed." droppable="true" raised="true" multi="false" method="POST" target="{{fileUploadTarget}}">Choose File</file-upload>
                        <div class="flex"></div>
                        </paper-card>

                </iron-pages>
            </div>

        </div>


        

        <div class="floating-action-bar layout horizontal wrap">
            <paper-menu-button horizontal-align="right" vertical-align="bottom">
                <paper-fab id="addSectionButton" icon="more-vert" class="dropdown-trigger minor-action-fab" title="Add new section."></paper-fab>
                <paper-menu class="dropdown-content">
                    <paper-fab id="addSectionButton" on-tap="onAddSection" icon="add-circle" class="minor-action-fab" title="Embedd text to the message content."></paper-fab>
                    <paper-fab id="addVideoButton" on-tap="onEmbedVideo" icon="theaters" class="minor-action-fab" title="Embedd video to the message content."></paper-fab>
                    <paper-fab id="addImageButton" on-tap="onEmbedImage" icon="perm-media" class="minor-action-fab" title="Embedd image to the message content."></paper-fab>
                    <paper-fab id="addLinkButton" on-tap="onEmbedLink" icon="link" class="minor-action-fab" title="Embedd a link to another message to the message content."></paper-fab>
                </paper-menu>
            </paper-menu-button>


            
            <paper-fab icon="save" on-tap="onShare" title="Publish content" id="sendMessageFab"></paper-fab>
            <paper-fab icon="clear" on-tap="onClear" title="Cancel all changes &amp; create new article." id="sendNewContentFab"></paper-fab>

        </div>

    </template>

    <script>Polymer({is:"mlm-share-view",behaviors:[PlutoniumBehaviors.WidgetBehavior],properties:{shareAjaxRequest:{},pageDto:{type:Object,notify:!0},contentModel:{type:Object,notify:!0,value:{sections:[]}},shareModel:{type:Object,notify:!0,value:{recipients:[]}},selectedItemIds:{type:Array,notify:!0},selectedMetaAction:{type:String,notify:!0,value:"content"},articleContentType:{type:String,notify:!0,value:"assembled"},articleContentHeading:{type:String,notify:!0,computed:"computeHeader(articleContentType)"},recipients:{type:String,notify:!0,value:""}},observers:["itemsAddedOrRemoved(selectedItemIds.splices)"],listeners:{create:"onSectionCreate",remove:"onRemoveItem",share:"onShare","shareAjax.error":"onShareError","shareAjax.response":"onShareResponse"},ready:function(){console.log(this.is+" is ready.")},onClear:function(){},onSectionCreate:function(e,t){this.$.pcf.onCreateSectionInParent(e,t)},onShare:function(e,t){console.log("Save content: "+JSON.stringify(this.contentModel)),this.contentModel.leaf=!0,this.$.shareAjax.generateRequest()},onShareError:function(){this.fire("feedback",{message:"Content sharing failed."})},onShareResponse:function(){this.fire("feedback",{message:void 0===this.contentModel.id||null===this.contentModel?"New content shared successfully.":"Content modified successfully."}),document.querySelector("#childTocAjax").generateRequest()},onNewArticle:function(){this.contentModel={sections:[]}},onOpenRecipientsDialog:function(){console.log(this.is+" send event pick-recipients."),this.fire("pick-recipients",{})},onClearRecipients:function(){this.splice("selectedItemIds",0,this.selectedItemIds.length),console.log("mlm-recipient-picker clear recipients.")},itemsAddedOrRemoved:function(e){if(void 0!==e&&null!==e){console.log("mlm-recipient-picker change recipients: "+JSON.stringify(this.selectedItemIds));var t="";void 0!==this.items&&null!==this.items&&this.items.forEach(function(e,n){this.selectedItemIds.indexOf(e.id)>-1&&(t+=e.name+" ")},this),this.recipients=t}},onRemoveItem:function(e,t){e.stopPropagation(),this.splice("selectedItemIds",this.selectedItemIds.indexOf(e.currentTarget.member),1)},computeHeader:function(e){return"assembled"===e?"Edit content":"Attach file"},onOnlySaveContent:function(e,t){console.log("Save content.")},onSendMessage:function(e,t){this.shareModel.recipients=this.selectedItemIds,this.shareModel.message=this.message,this.shareModel.contentId=this.contentModel.id,this.$.messageSendAjax.generateRequest()},onMessageSendResponse:function(){this.selectedMetaAction="content",this.fire("feedback",{message:"Message sent successfully."})},onMessageSendError:function(){this.fire("feedback",{message:"Message sending failed."})},getUserName:function(e){if(void 0!==this.items&&null!==this.items){var t="Unknown";return this.items.forEach(function(n,i){n.id===e&&(t=n.name)},this),t}},getUserEmail:function(e){if(void 0!==this.items&&null!==this.items){var t="Unknown";return this.items.forEach(function(n,i){n.id===e&&(t=n.email)},this),t}},getRoleIcon:function(e){if(void 0!==this.items&&null!==this.items){var t="Unknown";return this.items.forEach(function(n,i){n.id===e&&(t="M")},this),t}},onAddSection:function(){console.log("Add section after field[section"+this.contentModel.sections.length+"]"),this.fire("create",{name:"section"+this.contentModel.sections.length,type:"plutonium-cm-editor-text",title:"",data:""})},onEmbedVideo:function(){console.log("Embed video to after field[section"+this.contentModel.sections.length+"]"),this.fire("create",{name:"section"+this.contentModel.sections.length,type:"plutonium-cm-editor-video",title:"",data:""})},onEmbedImage:function(){console.log("Embed image to after field[section"+this.contentModel.sections.length+"]"),this.fire("create",{name:this.name,type:"plutonium-cm-editor-image",title:"",data:""})},onEmbedLink:function(){console.log("Embed link to after field[section"+this.contentModel.sections.length+"]"),this.fire("create",{name:"section"+this.contentModel.sections.length,type:"plutonium-cm-editor-link",title:"",data:""})}});</script>

</dom-module></body></html>